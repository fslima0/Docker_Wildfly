image: maven:latest

variables:
  MAVEN_OPTS: "-Dmaven.repo.local=.m2/repository"

cache:
  paths:
    - .m2/repository/

stages:
 - build
 - test
 - package
 - deploy

build:
 stage: build
 script:
   - mvn compile

test:
 stage: test
 script:
   - mvn test

package:
 stage: package
 rules:
   - if: '$CI_COMMIT_TAG ~= /^.*-rc.*$/'
 script:
   - mvn -DskipTests=true package
 artifacts:
   paths:
 	- target/app.war

deploy:
 stage: deploy
 dependencies:
   - build
   - test
   - package
 image: jboss/wildfly
 before_script:
   - chmod +x ./deploy.sh
 script:
   - ./deploy.sh
